{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "data-viewer",
  "type": "registry:block",
  "dependencies": [
    "json-bigint",
    "json5-bigint",
    "shiki",
    "tm-themes",
    "yaml"
  ],
  "devDependencies": [
    "@types/json-bigint",
    "tailwind-scrollbar"
  ],
  "registryDependencies": [
    "button",
    "button-group",
    "dialog",
    "dropdown-menu",
    "input",
    "separator",
    "sonner",
    "textarea",
    "tooltip"
  ],
  "files": [
    {
      "path": "src/components/ui/conanyu/data-viewer.tsx",
      "content": "// https://github.com/conanyu/data-viewer/blob/main/app/page/src/components/ui/conanyu/data-viewer.tsx\n\nimport JSONBigInt from 'json-bigint';\nimport JSON5 from 'json5-bigint';\nimport YAML from 'yaml';\nimport { ButtonGroup } from '@/components/ui/button-group.tsx';\nimport { type ReactNode, useEffect, useMemo, useState } from 'react';\nimport { Tooltip, TooltipContent, TooltipTrigger } from '@/components/ui/tooltip.tsx';\nimport { cn } from '@/lib/utils.ts';\nimport { buttonVariants } from '@/components/ui/button.tsx';\nimport {\n  CircleMinus,\n  CirclePlus,\n  CopyIcon,\n  Ellipsis,\n  Eye,\n  EyeOff,\n  LoaderCircle,\n  Maximize,\n  Palette,\n  SquarePen,\n} from 'lucide-react';\nimport { toast } from 'sonner';\nimport { Toaster } from '@/components/ui/sonner.tsx';\nimport { createHighlighter, type HighlighterGeneric, type ThemeRegistration, type TokensResult } from 'shiki';\nimport { Dialog, DialogContent, DialogTitle, DialogTrigger } from '@/components/ui/dialog.tsx';\nimport { VisuallyHidden } from '@radix-ui/react-visually-hidden';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuGroup,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu.tsx';\nimport { Textarea } from '@/components/ui/textarea.tsx';\nimport { Button } from '@/components/ui/button.tsx';\nimport { Input } from '@/components/ui/input.tsx';\n\n// theme\nimport Andromeeda from 'tm-themes/themes/andromeeda.json';\nimport AuroraX from 'tm-themes/themes/aurora-x.json';\nimport AyuDark from 'tm-themes/themes/ayu-dark.json';\nimport CatppuccinFrappe from 'tm-themes/themes/catppuccin-frappe.json';\nimport CatppuccinLatte from 'tm-themes/themes/catppuccin-latte.json';\nimport CatppuccinMacchiato from 'tm-themes/themes/catppuccin-macchiato.json';\nimport CatppuccinMocha from 'tm-themes/themes/catppuccin-mocha.json';\nimport DarkPlus from 'tm-themes/themes/dark-plus.json';\nimport Dracula from 'tm-themes/themes/dracula.json';\nimport DraculaSoft from 'tm-themes/themes/dracula-soft.json';\nimport EverforestDark from 'tm-themes/themes/everforest-dark.json';\nimport EverforestLight from 'tm-themes/themes/everforest-light.json';\nimport GitHubDark from 'tm-themes/themes/github-dark.json';\nimport GitHubDarkDefault from 'tm-themes/themes/github-dark-default.json';\nimport GitHubDarkDimmed from 'tm-themes/themes/github-dark-dimmed.json';\nimport GitHubDarkHighContrast from 'tm-themes/themes/github-dark-high-contrast.json';\nimport GitHubLight from 'tm-themes/themes/github-light.json';\nimport GitHubLightDefault from 'tm-themes/themes/github-light-default.json';\nimport GitHubLightHighContrast from 'tm-themes/themes/github-light-high-contrast.json';\nimport GruvboxDarkHard from 'tm-themes/themes/gruvbox-dark-hard.json';\nimport GruvboxDarkMedium from 'tm-themes/themes/gruvbox-dark-medium.json';\nimport GruvboxDarkSoft from 'tm-themes/themes/gruvbox-dark-soft.json';\nimport GruvboxLightHard from 'tm-themes/themes/gruvbox-light-hard.json';\nimport GruvboxLightMedium from 'tm-themes/themes/gruvbox-light-medium.json';\nimport GruvboxLightSoft from 'tm-themes/themes/gruvbox-light-soft.json';\nimport Houston from 'tm-themes/themes/houston.json';\nimport KanagawaDragon from 'tm-themes/themes/kanagawa-dragon.json';\nimport KanagawaLotus from 'tm-themes/themes/kanagawa-lotus.json';\nimport KanagawaWave from 'tm-themes/themes/kanagawa-wave.json';\nimport LaserWave from 'tm-themes/themes/laserwave.json';\nimport LightPlus from 'tm-themes/themes/light-plus.json';\nimport MaterialTheme from 'tm-themes/themes/material-theme.json';\nimport MaterialThemeDarker from 'tm-themes/themes/material-theme-darker.json';\nimport MaterialThemeLighter from 'tm-themes/themes/material-theme-lighter.json';\nimport MaterialThemeOcean from 'tm-themes/themes/material-theme-ocean.json';\nimport MaterialThemePalenight from 'tm-themes/themes/material-theme-palenight.json';\nimport MinDark from 'tm-themes/themes/min-dark.json';\nimport MinLight from 'tm-themes/themes/min-light.json';\nimport Monokai from 'tm-themes/themes/monokai.json';\nimport NightOwl from 'tm-themes/themes/night-owl.json';\nimport Nord from 'tm-themes/themes/nord.json';\nimport OneDarkPro from 'tm-themes/themes/one-dark-pro.json';\nimport OneLight from 'tm-themes/themes/one-light.json';\nimport Plastic from 'tm-themes/themes/plastic.json';\nimport Poimandres from 'tm-themes/themes/poimandres.json';\nimport Red from 'tm-themes/themes/red.json';\nimport RosePine from 'tm-themes/themes/rose-pine.json';\nimport RosePineDawn from 'tm-themes/themes/rose-pine-dawn.json';\nimport RosePineMoon from 'tm-themes/themes/rose-pine-moon.json';\nimport SlackDark from 'tm-themes/themes/slack-dark.json';\nimport SlackOchin from 'tm-themes/themes/slack-ochin.json';\nimport SnazzyLight from 'tm-themes/themes/snazzy-light.json';\nimport SolarizedDark from 'tm-themes/themes/solarized-dark.json';\nimport SolarizedLight from 'tm-themes/themes/solarized-light.json';\nimport Synthwave84 from 'tm-themes/themes/synthwave-84.json';\nimport TokyoNight from 'tm-themes/themes/tokyo-night.json';\nimport Vesper from 'tm-themes/themes/vesper.json';\nimport VitesseBlack from 'tm-themes/themes/vitesse-black.json';\nimport VitesseDark from 'tm-themes/themes/vitesse-dark.json';\nimport VitesseLight from 'tm-themes/themes/vitesse-light.json';\n\nconst themes = {\n  Andromeeda: Andromeeda,\n  'Aurora X': AuroraX,\n  'Ayu Dark': AyuDark,\n  'Catppuccin Frappé': CatppuccinFrappe,\n  'Catppuccin Latte': CatppuccinLatte,\n  'Catppuccin Macchiato': CatppuccinMacchiato,\n  'Catppuccin Mocha': CatppuccinMocha,\n  'Dark Plus': DarkPlus,\n  'Dracula Theme': Dracula,\n  'Dracula Theme Soft': DraculaSoft,\n  'Everforest Dark': EverforestDark,\n  'Everforest Light': EverforestLight,\n  'GitHub Dark': GitHubDark,\n  'GitHub Dark Default': GitHubDarkDefault,\n  'GitHub Dark Dimmed': GitHubDarkDimmed,\n  'GitHub Dark High Contrast': GitHubDarkHighContrast,\n  'GitHub Light': GitHubLight,\n  'GitHub Light Default': GitHubLightDefault,\n  'GitHub Light High Contrast': GitHubLightHighContrast,\n  'Gruvbox Dark Hard': GruvboxDarkHard,\n  'Gruvbox Dark Medium': GruvboxDarkMedium,\n  'Gruvbox Dark Soft': GruvboxDarkSoft,\n  'Gruvbox Light Hard': GruvboxLightHard,\n  'Gruvbox Light Medium': GruvboxLightMedium,\n  'Gruvbox Light Soft': GruvboxLightSoft,\n  Houston: Houston,\n  'Kanagawa Dragon': KanagawaDragon,\n  'Kanagawa Lotus': KanagawaLotus,\n  'Kanagawa Wave': KanagawaWave,\n  LaserWave: LaserWave,\n  'Light Plus': LightPlus,\n  'Material Theme': MaterialTheme,\n  'Material Theme Darker': MaterialThemeDarker,\n  'Material Theme Lighter': MaterialThemeLighter,\n  'Material Theme Ocean': MaterialThemeOcean,\n  'Material Theme Palenight': MaterialThemePalenight,\n  'Min Dark': MinDark,\n  'Min Light': MinLight,\n  Monokai: Monokai,\n  'Night Owl': NightOwl,\n  Nord: Nord,\n  'One Dark Pro': OneDarkPro,\n  'One Light': OneLight,\n  Plastic: Plastic,\n  Poimandres: Poimandres,\n  Red: Red,\n  'Rosé Pine': RosePine,\n  'Rosé Pine Dawn': RosePineDawn,\n  'Rosé Pine Moon': RosePineMoon,\n  'Slack Dark': SlackDark,\n  'Slack Ochin': SlackOchin,\n  'Snazzy Light': SnazzyLight,\n  'Solarized Dark': SolarizedDark,\n  'Solarized Light': SolarizedLight,\n  \"Synthwave '84\": Synthwave84,\n  'Tokyo Night': TokyoNight,\n  Vesper: Vesper,\n  'Vitesse Black': VitesseBlack,\n  'Vitesse Dark': VitesseDark,\n  'Vitesse Light': VitesseLight,\n};\n\nconst JSON = JSONBigInt({ useNativeBigInt: true });\n\n// 转化逻辑\nconst dataType = ['json', 'json5', 'yaml'] as const;\ntype DataType = (typeof dataType)[number];\n\ntype AutoDetectFunc = (text: string) => unknown;\nconst autoDetectMap: Record<DataType, AutoDetectFunc> = {\n  json: JSON.parse,\n  json5: JSON5.parse,\n  yaml: (text: string) => YAML.parse(text, { intAsBigInt: true }),\n};\n\nfunction autoDetect(props: { data: string; type?: DataType }):\n  | {\n      type: 'error';\n      data: undefined;\n      error: string;\n    }\n  | {\n      type: DataType;\n      data: unknown;\n      error: undefined;\n    } {\n  const { data, type } = props;\n  if (!type) {\n    let error;\n    for (const type of dataType) {\n      let result = undefined;\n      try {\n        result = autoDetectMap[type](data);\n      } catch (e) {\n        if (type === 'json5') {\n          error = e;\n        }\n      }\n      if (result === undefined) {\n        continue;\n      }\n      if (type === 'yaml' && (result === null || ['bigint', 'number', 'string', 'boolean'].includes(typeof result))) {\n        continue;\n      }\n      return { type, data: result, error: undefined };\n    }\n    return { type: 'error', error: `${error}`, data: undefined };\n  }\n  try {\n    return { type, data: autoDetectMap[type](data), error: undefined };\n  } catch (e) {\n    return { type: 'error', error: `${e}`, data: undefined };\n  }\n}\n\n// 交互逻辑\ntype InteractionResult =\n  | {\n      event?:\n        | ((e: MouseEvent) => void) // 点击回调\n        | ReactNode; // 弹窗\n      title?: ReactNode; // Tooltip 文案\n      highPriority?: boolean; // 是否高优先级\n    }\n  | undefined;\n\ntype Interaction = (r: {\n  data: unknown;\n  depth: number;\n  config?: DataViewerConfig;\n  onDataChange?: (data: unknown) => void;\n}) => InteractionResult;\n\nconst TooltipButton = ({\n  tooltip,\n  icon,\n  onClick,\n  link,\n}: {\n  tooltip: ReactNode;\n  icon: ReactNode;\n  onClick?: () => void;\n  link?: string;\n}) => {\n  return (\n    <Tooltip>\n      <TooltipTrigger\n        className={buttonVariants({\n          variant: 'outline',\n          size: 'icon',\n          className: 'cursor-pointer bg-white text-gray-600',\n        })}\n        onClick={onClick}\n      >\n        {link ? (\n          <a href={link} onClick={e => e.preventDefault()}>\n            {icon}\n          </a>\n        ) : (\n          icon\n        )}\n      </TooltipTrigger>\n      <TooltipContent>{tooltip}</TooltipContent>\n    </Tooltip>\n  );\n};\n\nfunction LongTextDialogContent({ data, config }: { data: string; config?: DataViewerConfig }) {\n  const [showToolbar, setShowToolbar] = useState(true);\n\n  return (\n    <div className=\"relative overflow-auto scrollbar-thin border-2 rounded-md\">\n      <pre\n        className={cn(\n          showToolbar ? 'overflow-y-scroll' : 'overflow-auto',\n          'scrollbar-thin max-h-[80vh] p-4 text-sm font-mono whitespace-pre-wrap',\n        )}\n        style={{\n          backgroundColor: config?.defaultTheme?.bg || config?.defaultTheme?.colors?.['editor.background'],\n          color: config?.defaultTheme?.fg || config?.defaultTheme?.colors?.['editor.foreground'],\n        }}\n      >\n        {data}\n      </pre>\n      <div className={cn('absolute right-4 top-2', !showToolbar && 'hidden')}>\n        <ButtonGroup>\n          <div className={buttonVariants({ variant: 'outline' })}>长文本</div>\n          <TooltipButton\n            tooltip=\"复制\"\n            icon={<CopyIcon />}\n            onClick={async () => {\n              await navigator.clipboard.writeText(data);\n              toast.success('复制成功');\n            }}\n          />\n          <TooltipButton tooltip=\"隐藏工具栏\" icon={<EyeOff />} onClick={() => setShowToolbar(false)} />\n        </ButtonGroup>\n      </div>\n    </div>\n  );\n}\n\nconst defaultInteraction: Interaction = ({ data, depth, config, onDataChange }) => {\n  const length = collapseLength(data);\n  const viewer = (data: unknown, title?: string, callback?: (v: unknown) => void) => {\n    return (\n      <DataViewer\n        data={JSON.stringify(data)}\n        title={title}\n        config={{ ...config, type: 'json', withToaster: false }}\n        className=\"border-2 rounded-md\"\n        preClassName=\"max-h-[80vh]\"\n        onDataChange={callback ?? onDataChange}\n      />\n    );\n  };\n  if (depth > 0 && length > 0) {\n    return {\n      event: viewer(data, 'JSON'),\n      title: 'JSON',\n    };\n  }\n  if (typeof data === 'string' && data) {\n    if (data.startsWith('https://') || data.startsWith('http://')) {\n      return {\n        event: () => {\n          window.open(data, '_blank');\n        },\n        title: '链接',\n      };\n    }\n    const tryParseResult = autoDetect({ data });\n    if (typeof tryParseResult.error !== 'string') {\n      const { type, data } = tryParseResult;\n      if (\n        (type !== 'yaml' && !['number', 'bigint'].includes(typeof data)) ||\n        (type === 'yaml' && !['string', 'number', 'bigint'].includes(typeof data))\n      ) {\n        const title = type === 'json' ? 'JSON' : type === 'json5' ? 'JSON5' : 'YAML';\n        let callback;\n        switch (type) {\n          case 'json':\n            callback = (v: unknown) => onDataChange?.(JSON.stringify(v));\n            break;\n          case 'json5':\n            callback = (v: unknown) => onDataChange?.(JSON5.stringify(v));\n            break;\n          case 'yaml':\n            callback = (v: unknown) => onDataChange?.(YAML.stringify(v));\n            break;\n        }\n        return {\n          event: viewer(data, title, callback),\n          title,\n        };\n      }\n    }\n    if (data.length > (config?.showInteractionWithStringLengthGte ?? 100)) {\n      return {\n        event: <LongTextDialogContent data={data} config={config} />,\n        title: '长文本',\n      };\n    }\n  }\n  return undefined;\n};\n\n// 内部组件\ninterface InnerViewerProps {\n  themeInfo: ThemeRegistration;\n  node: ViewerNode;\n  mode: 'normal' | 'edit';\n  onValueChange: (v: unknown) => void;\n  config?: DataViewerConfig;\n}\n\nfunction collapseLength(v: unknown): number {\n  return typeof v === 'object' && v !== null ? Object.keys(v).length : 0;\n}\n\nfunction InteractionCircle({\n  onClick,\n  content,\n  className,\n  themeInfo,\n}: {\n  onClick: (e: MouseEvent) => void;\n  content: string;\n  className?: string;\n  themeInfo: ThemeRegistration;\n}) {\n  const [hover, setHover] = useState(false);\n  return (\n    <span\n      className={cn('font-sans mr-0.5 select-none cursor-pointer opacity-70 hover:opacity-100', className)}\n      onMouseEnter={() => setHover(true)}\n      onMouseLeave={() => setHover(false)}\n      onClick={e => onClick(e.nativeEvent)}\n      style={{\n        color: hover\n          ? themeInfo.colors?.['button.hoverBackground'] || themeInfo.colors?.['button.background']\n          : themeInfo.colors?.['button.background'],\n      }}\n    >\n      {content}\n    </span>\n  );\n}\n\nfunction InteractionTriangle({\n  themeInfo,\n  onClick,\n  collapsed,\n}: {\n  themeInfo: ThemeRegistration;\n  onClick: (e: MouseEvent) => void;\n  collapsed: boolean;\n}) {\n  const [hover, setHover] = useState(false);\n  return (\n    <span\n      className={cn(\n        'cursor-pointer absolute text-center left-4 select-none top-[-0.2rem] text-base opacity-70',\n        collapsed && 'rotate-270',\n      )}\n      onClick={e => onClick(e.nativeEvent)}\n      onMouseEnter={() => setHover(true)}\n      onMouseLeave={() => setHover(false)}\n      style={{\n        color: hover\n          ? themeInfo.colors?.['button.hoverBackground'] || themeInfo.colors?.['button.background']\n          : themeInfo.colors?.['button.background'],\n      }}\n    >\n      {'\\u25BC'}\n    </span>\n  );\n}\n\nfunction AddValueDialogContent({\n  isArray,\n  onSubmitValue,\n  config,\n}: {\n  isArray: boolean;\n  onSubmitValue: (k: string, v: unknown) => void;\n  config?: DataViewerConfig;\n}) {\n  const [key, setKey] = useState('');\n  const [value, setValue] = useState('\"输入数据\"');\n  const data = useMemo(() => autoDetect({ data: value, type: config?.type }), [value, config?.type]);\n\n  return (\n    <DialogContent\n      className=\"w-full !max-w-[60vw]\"\n      onOpenAutoFocus={e => e.preventDefault()}\n      showCloseButton={false}\n      aria-describedby={undefined}\n    >\n      <VisuallyHidden asChild>\n        <DialogTitle />\n      </VisuallyHidden>\n      <div className=\"flex gap-4\">\n        <div className=\"h-[calc(60vh-2rem)]\">\n          {isArray ? (\n            <Textarea\n              className=\"w-[calc(30vw-1.75rem)] h-full resize-none scrollbar-thin bg-gray-100\"\n              value={value}\n              onChange={e => setValue(e.target.value)}\n              placeholder=\"输入数据\"\n            />\n          ) : (\n            <>\n              <Input\n                className=\"w-[calc(30vw-1.75rem)] mb-4 bg-gray-100\"\n                placeholder=\"输入KEY\"\n                value={key}\n                onChange={e => setKey(e.target.value)}\n              />\n              <Textarea\n                className=\"w-[calc(30vw-1.75rem)] h-[calc(60vh-5.25rem)] resize-none scrollbar-thin bg-gray-100\"\n                value={value}\n                onChange={e => setValue(e.target.value)}\n                placeholder=\"输入数据\"\n              />\n            </>\n          )}\n        </div>\n        <div className=\"border-2 rounded-md w-[calc(30vw-2.25rem)] h-[calc(60vh-2rem)] relative\">\n          <DataViewer\n            className=\"rounded-md h-full\"\n            preClassName=\"h-full\"\n            data={value}\n            onDataChange={data => setValue(JSON.stringify(data, null, 2))}\n            config={{ ...config, withToaster: false }}\n          />\n          <Button\n            className=\"absolute bottom-3 right-5 cursor-pointer\"\n            size=\"sm\"\n            disabled={(!isArray && !key) || !!data.error}\n            onClick={() => onSubmitValue(key, data.data)}\n          >\n            确认\n          </Button>\n        </div>\n      </div>\n    </DialogContent>\n  );\n}\n\nfunction InnerViewer(props: InnerViewerProps) {\n  const { node, config, themeInfo, mode, onValueChange } = props;\n  const { forceDefaultCollapseLengthGte } = config || {};\n  const [collapsed, setCollapsed] = useState(node.length > (forceDefaultCollapseLengthGte || 100));\n  const [keyHover, setKeyHover] = useState(false);\n  const [dialogOpen, setDialogOpen] = useState(false);\n\n  useEffect(() => {\n    setCollapsed(node.length > (forceDefaultCollapseLengthGte || 100));\n  }, [node.length, config?.forceDefaultCollapseLengthGte]);\n\n  const interaction = useMemo(() => {\n    const props = { data: node.data, depth: node.depth, config, onDataChange: onValueChange };\n    const interaction = config?.additionalInteraction?.(props);\n    if (interaction?.highPriority) {\n      return interaction;\n    }\n    return defaultInteraction(props) || interaction;\n  }, [node, config?.additionalInteraction]);\n\n  let interactionTrigger: ReactNode = null;\n\n  if (mode === 'normal') {\n    if (interaction) {\n      interactionTrigger = (\n        <InteractionCircle\n          content={'\\u25CF'}\n          key=\"interaction-trigger\"\n          onClick={e => {\n            if (typeof interaction.event === 'function') {\n              interaction.event(e);\n            }\n          }}\n          themeInfo={themeInfo}\n        />\n      );\n      if (interaction.title) {\n        interactionTrigger = (\n          <Tooltip key=\"interaction-tooltip\">\n            <TooltipTrigger>{interactionTrigger}</TooltipTrigger>\n            <TooltipContent>{interaction.title}</TooltipContent>\n          </Tooltip>\n        );\n      }\n      if (typeof interaction.event !== 'function') {\n        interactionTrigger = (\n          <Dialog key=\"interaction-dialog\">\n            <DialogTrigger>{interactionTrigger}</DialogTrigger>\n            <DialogContent\n              showCloseButton={false}\n              autoFocus={false}\n              onOpenAutoFocus={e => e.preventDefault()}\n              className=\"w-full !max-w-[80vw]\"\n              aria-describedby={undefined}\n            >\n              <VisuallyHidden asChild>\n                <DialogTitle />\n              </VisuallyHidden>\n              {interaction.event}\n            </DialogContent>\n          </Dialog>\n        );\n      }\n    }\n  } else if (mode === 'edit') {\n    if (node.depth !== 0) {\n      interactionTrigger = (\n        <Tooltip key=\"interaction-minus\">\n          <TooltipTrigger>\n            <CircleMinus\n              className=\"inline-block align-text-top w-3 h-3 mt-0.5 cursor-pointer mr-0.5\"\n              onClick={() => onValueChange(undefined)}\n              style={{ color: themeInfo.colors?.['button.background'] }}\n            />\n          </TooltipTrigger>\n          <TooltipContent>删除</TooltipContent>\n        </Tooltip>\n      );\n    }\n    if (node.data !== null && typeof node.data === 'object') {\n      const isArray = Array.isArray(node.data);\n      interactionTrigger = (\n        <span key=\"interaction-plus\">\n          <Dialog open={dialogOpen} onOpenChange={setDialogOpen}>\n            <DialogTrigger>\n              <Tooltip>\n                <TooltipTrigger asChild>\n                  <CirclePlus\n                    className=\"inline-block align-text-top w-3 h-3 mt-0.5 cursor-pointer mr-1\"\n                    style={{ color: themeInfo.colors?.['button.background'] }}\n                  />\n                </TooltipTrigger>\n                <TooltipContent>添加</TooltipContent>\n              </Tooltip>\n            </DialogTrigger>\n            <AddValueDialogContent\n              isArray={isArray}\n              config={config}\n              onSubmitValue={(k, v) => {\n                if (isArray) {\n                  (node.data as unknown[]).push(v);\n                } else {\n                  (node.data as Record<string, unknown>)[k] = v;\n                }\n                onValueChange(node.data);\n                setDialogOpen(false);\n              }}\n            />\n          </Dialog>\n          {interactionTrigger}\n        </span>\n      );\n    }\n  }\n\n  return (\n    <div className=\"relative\">\n      {node.length > 0 && (\n        <InteractionTriangle\n          onClick={() => {\n            setCollapsed(collapsed => !collapsed);\n          }}\n          collapsed={collapsed}\n          themeInfo={themeInfo}\n        />\n      )}\n      <div className=\"pl-8\">\n        {node.before.map((item, index) => {\n          if (item.type === ViewerContentTypeInteraction) {\n            return interactionTrigger;\n          }\n          const canCollapse = item.type === ViewerContentTypeKey && node.length > 0;\n          return (\n            <span\n              key={index}\n              style={{ color: item.color }}\n              className={cn(canCollapse && keyHover && 'cursor-pointer')}\n              onMouseEnter={() => canCollapse && setKeyHover(true)}\n              onMouseLeave={() => canCollapse && setKeyHover(false)}\n              onClick={() => {\n                if (canCollapse) {\n                  setCollapsed(collapsed => !collapsed);\n                }\n              }}\n            >\n              {item.content}\n            </span>\n          );\n        })}\n        {collapsed ? (\n          <span\n            style={{ color: themeInfo.fg || themeInfo.colors?.['editor.foreground'] }}\n            className=\"px-3 hover:underline cursor-pointer\"\n            onClick={() => setCollapsed(false)}\n          >\n            {node.length} item{node.length > 1 ? 's' : ''}\n          </span>\n        ) : node.children.length > 0 ? (\n          <div className=\"border-l border-dotted\" style={{ borderColor: themeInfo.colors?.['editor.foreground'] }}>\n            {node.children.map((item, index) => (\n              <InnerViewer\n                key={index}\n                {...props}\n                mode={mode}\n                node={item}\n                onValueChange={value => {\n                  let data = node.data;\n                  if (data !== null) {\n                    if (value === undefined) {\n                      if (Array.isArray(data)) {\n                        data = data.filter((_, i) => i !== index);\n                      } else if (typeof data === 'object') {\n                        const newData: Record<string, unknown> = {};\n                        Object.entries(data).forEach(([key, dataValue], i) => {\n                          if (i !== index) {\n                            newData[key] = dataValue;\n                          }\n                        });\n                        data = newData;\n                      }\n                    } else {\n                      if (Array.isArray(data)) {\n                        data[index] = value;\n                      } else if (typeof data === 'object') {\n                        const newData: Record<string, unknown> = {};\n                        Object.entries(data).forEach(([key, dataValue], i) => {\n                          newData[key] = i !== index ? dataValue : value;\n                        });\n                        data = newData;\n                      }\n                    }\n                    onValueChange(data);\n                  }\n                }}\n              />\n            ))}\n          </div>\n        ) : null}\n        {node.after.map((item, index) => (\n          <span key={index} style={{ color: item.color }}>\n            {item.content}\n          </span>\n        ))}\n      </div>\n    </div>\n  );\n}\n\n// 计算层级和颜色\nconst ViewerContentTypeNormal = 0 as const;\nconst ViewerContentTypeKey = 1 as const;\nconst ViewerContentTypeInteraction = 2 as const;\ntype ViewerContentType =\n  | typeof ViewerContentTypeNormal\n  | typeof ViewerContentTypeKey\n  | typeof ViewerContentTypeInteraction;\n\ninterface ViewerContent {\n  content: string;\n  color?: string;\n  type: ViewerContentType;\n}\n\ninterface ViewerNode {\n  data: unknown;\n  length: number;\n  depth: number;\n  before: ViewerContent[];\n  children: ViewerNode[];\n  after: ViewerContent[];\n}\n\nfunction calcDfs(props: {\n  data: unknown;\n  color: (string | undefined)[];\n  from: number;\n  depth: number;\n  key?: string;\n  comma?: boolean;\n}): [ViewerNode, number] {\n  const { data, color, from, depth, key, comma } = props;\n  const length = collapseLength(data);\n  const node: ViewerNode = {\n    length: length,\n    before: [],\n    children: [],\n    depth,\n    after: [],\n    data: data,\n  };\n  let index = from;\n  const toViewerContent = (s: string, type?: ViewerContentType) => {\n    const current: ViewerContent[] = [];\n    for (const c of s) {\n      const lastColor = current?.[current.length - 1]?.color;\n      const currentColor = color?.[index];\n      if (lastColor === currentColor) {\n        current[current.length - 1].content += c;\n      } else {\n        current.push({ content: c, color: currentColor, type: type || ViewerContentTypeNormal });\n      }\n      index++;\n    }\n    return current;\n  };\n  if (key !== undefined) {\n    const current = toViewerContent(JSON.stringify(key), ViewerContentTypeKey);\n    node.before.push(...current, { content: ': ', color: color?.[index], type: ViewerContentTypeNormal });\n    index++;\n  }\n  node.before.push({ content: '', type: ViewerContentTypeInteraction });\n  if (typeof data === 'string') {\n    node.before.push(...toViewerContent(JSON.stringify(data)));\n  } else if (typeof data === 'number' || typeof data === 'bigint' || typeof data === 'boolean' || data === null) {\n    const text = data === null ? 'null' : data.toString();\n    node.before.push(...toViewerContent(text));\n  } else if (data instanceof Array) {\n    if (length > 0) {\n      node.before.push(...toViewerContent('['));\n      for (let i = 0; i < length; i++) {\n        const [child, newIndex] = calcDfs({\n          data: data[i],\n          color,\n          from: index,\n          depth: depth + 1,\n          comma: i < length - 1,\n        });\n        node.children.push(child);\n        index = newIndex;\n      }\n      node.after.push(...toViewerContent(']'));\n    } else {\n      node.before.push(...toViewerContent('[]'));\n    }\n  } else if (typeof data === 'object') {\n    if (length > 0) {\n      node.before.push(...toViewerContent('{'));\n      Object.entries(data).forEach(([key, son], objectIndex) => {\n        const [child, newIndex] = calcDfs({\n          data: son,\n          color,\n          from: index,\n          depth: depth + 1,\n          key,\n          comma: objectIndex < length - 1,\n        });\n        node.children.push(child);\n        index = newIndex;\n      });\n      node.after.push(...toViewerContent('}'));\n    } else {\n      node.before.push(...toViewerContent('{}'));\n    }\n  }\n\n  if (comma) {\n    node.after.push({ content: ',', color: color?.[index], type: ViewerContentTypeNormal });\n    index++;\n  }\n  return [node, index];\n}\n\nfunction calc(data: unknown, t: TokensResult): ViewerNode {\n  const color: (string | undefined)[] = [];\n  for (const t1 of t.tokens) {\n    for (const t2 of t1) {\n      for (let i = 0; i < t2.content.length; i++) {\n        color.push(t2.color);\n      }\n    }\n  }\n  return calcDfs({ data, color, from: 0, depth: 0 })[0];\n}\n\n// 入口组件\ninterface DataViewerConfig {\n  type?: DataType; // 强制制定数据类型 不填则根据数据自动判断\n  defaultTheme?: ThemeRegistration; // 默认自定义主题 默认为vitesse-light\n  withoutButtonGroup?: boolean; // 是否不展示操作按钮组\n  withToaster?: boolean; // 是否需要toaster\n  withoutMaximize?: boolean; // 是否不展示最大化按钮\n  withThemeChange?: boolean; // 是否开启主题切换\n  forceDefaultCollapseLengthGte?: number; // 强制默认折叠长度 不填则为100\n  showInteractionWithStringLengthGte?: number; // 展示交互的字符串长度阈值 不填则为100\n  additionalInteraction?: Interaction; // 自定义交互逻辑\n  uneditable?: boolean; // 是否可编辑\n}\n\ninterface DataViewerProps {\n  data: string;\n  className?: string;\n  preClassName?: string;\n  title?: string;\n  onDataChange?: (data: unknown) => void; // 数据编辑回调\n  onBundledThemeChange?: (theme: ThemeRegistration) => void; // 默认主题切换回调\n  onCloseButtonGroup?: (e: MouseEvent) => void; // 关闭工具栏回调\n  config?: DataViewerConfig;\n}\n\nconst globalHighlighter: Map<ThemeRegistration, HighlighterGeneric<string, string>> = new Map();\n\nfunction DataViewer(props: DataViewerProps) {\n  // 处理主题\n  const { type, defaultTheme, withoutButtonGroup, withoutMaximize, withToaster, withThemeChange, uneditable } =\n    props.config || {};\n  const [themeInfo, setThemeInfo] = useState<ThemeRegistration>(VitesseLight as ThemeRegistration);\n  useEffect(() => {\n    setThemeInfo(defaultTheme ? defaultTheme : (VitesseLight as ThemeRegistration));\n  }, [defaultTheme]);\n  const [withButtonGroup, setWithButtonGroup] = useState(!withoutButtonGroup);\n  const [source, setSource] = useState(props.data);\n  useEffect(() => {\n    setSource(props.data);\n  }, [props.data]);\n  const [mode, setMode] = useState<'normal' | 'edit'>('normal');\n\n  // 处理转化逻辑\n  const data = useMemo(() => autoDetect({ data: source, type: type }), [source, type]);\n\n  // 处理样式\n  const [highlighter, setHighlighter] = useState<[HighlighterGeneric<string, string>, ThemeRegistration] | undefined>(\n    undefined,\n  );\n\n  useEffect(() => {\n    (async () => {\n      const cachedHighlighter = globalHighlighter.get(themeInfo);\n      if (cachedHighlighter) {\n        setHighlighter([cachedHighlighter, themeInfo]);\n      } else {\n        const highlighter = (await createHighlighter({\n          langs: ['json'],\n          themes: [themeInfo],\n        })) as HighlighterGeneric<string, string>;\n        setHighlighter([highlighter, themeInfo]);\n        globalHighlighter.set(themeInfo, highlighter);\n      }\n    })();\n  }, [themeInfo]);\n\n  const [bgColor, fgColor, root] = useMemo(() => {\n    if (!highlighter || data.data === undefined) {\n      return [undefined, undefined, undefined];\n    }\n    const t = highlighter[0].codeToTokens(JSON.stringify(data.data), { lang: 'json', theme: highlighter[1] });\n    return [t.bg, t.fg, calc(data.data, t)];\n  }, [data, highlighter]);\n\n  return (\n    <>\n      {withToaster && <Toaster />}\n      <div className={cn('relative overflow-auto scrollbar-thin', props.className)}>\n        <pre\n          className={cn(\n            withButtonGroup ? 'overflow-y-scroll' : 'overflow-auto',\n            'scrollbar-thin py-4 text-sm font-mono',\n            props.preClassName,\n          )}\n          style={{ backgroundColor: bgColor, color: fgColor }}\n        >\n          {data.error ? (\n            <div className=\"px-4\" style={{ color: themeInfo.colors?.['editorError.foreground'] }}>\n              {data.error}\n            </div>\n          ) : root !== undefined ? (\n            <InnerViewer\n              mode={mode}\n              themeInfo={themeInfo}\n              node={root}\n              config={props.config}\n              onValueChange={value => {\n                setSource(JSON.stringify(value));\n                props.onDataChange?.(value);\n              }}\n            />\n          ) : (\n            <div className=\"px-4\">\n              <LoaderCircle className=\"animate-spin\" />\n            </div>\n          )}\n        </pre>\n        {withButtonGroup && !data.error && data.data !== undefined && (\n          <div className=\"absolute right-4 top-2\">\n            <ButtonGroup>\n              {props.title && <div className={buttonVariants({ variant: 'outline' })}>{props.title}</div>}\n              <TooltipButton\n                tooltip=\"复制为JSON\"\n                icon={<CopyIcon />}\n                onClick={async () => {\n                  await navigator.clipboard.writeText(JSON.stringify(data.data, null, 2));\n                  toast.success('复制成功');\n                }}\n              />\n              {!withoutMaximize && (\n                <Dialog>\n                  <DialogTrigger asChild>\n                    <TooltipButton tooltip=\"弹窗展示\" icon={<Maximize />} onClick={async () => {}} />\n                  </DialogTrigger>\n                  <DialogContent\n                    showCloseButton={false}\n                    autoFocus={false}\n                    onOpenAutoFocus={e => e.preventDefault()}\n                    className=\"w-full !max-w-[80vw]\"\n                    aria-describedby={undefined}\n                  >\n                    <DataViewer\n                      data={source}\n                      className=\"border-2 rounded-md h-full max-h-[80vh]\"\n                      preClassName=\"h-full\"\n                      onDataChange={data => {\n                        setSource(JSON.stringify(data, null, 2));\n                        props.onDataChange?.(data);\n                      }}\n                      config={{ ...props.config, withToaster: false, withoutMaximize: true }}\n                    />\n                  </DialogContent>\n                </Dialog>\n              )}\n              {!uneditable && (\n                <TooltipButton\n                  tooltip=\"切换模式\"\n                  icon={mode === 'normal' ? <Eye /> : <SquarePen />}\n                  onClick={() => setMode(mode === 'normal' ? 'edit' : 'normal')}\n                />\n              )}\n              {withThemeChange && (\n                <DropdownMenu>\n                  <DropdownMenuTrigger\n                    className={buttonVariants({\n                      variant: 'outline',\n                      size: 'icon',\n                      className: 'cursor-pointer bg-white text-gray-600',\n                    })}\n                  >\n                    <Tooltip>\n                      <TooltipTrigger\n                        className={buttonVariants({\n                          variant: 'outline',\n                          size: 'icon',\n                          className: 'cursor-pointer rounded-none border-x-0 border-y',\n                        })}\n                        style={{ boxShadow: '0 0' }}\n                      >\n                        <Palette />\n                      </TooltipTrigger>\n                      <TooltipContent>切换主题</TooltipContent>\n                    </Tooltip>\n                  </DropdownMenuTrigger>\n                  <DropdownMenuContent className=\"scrollbar-thin\">\n                    <DropdownMenuGroup>\n                      {Object.entries(themes).map(([key, value]) => (\n                        <DropdownMenuItem\n                          key={key}\n                          className=\"cursor-pointer\"\n                          onClick={() => {\n                            setThemeInfo(value as ThemeRegistration);\n                            props.onBundledThemeChange?.(value as ThemeRegistration);\n                          }}\n                        >\n                          {key}\n                        </DropdownMenuItem>\n                      ))}\n                    </DropdownMenuGroup>\n                  </DropdownMenuContent>\n                </DropdownMenu>\n              )}\n              <DropdownMenu>\n                <DropdownMenuTrigger\n                  className={buttonVariants({\n                    variant: 'outline',\n                    size: 'icon',\n                    className: 'cursor-pointer bg-white text-gray-600',\n                  })}\n                >\n                  <Ellipsis />\n                </DropdownMenuTrigger>\n                <DropdownMenuContent>\n                  <DropdownMenuGroup>\n                    <DropdownMenuItem\n                      className=\"cursor-pointer\"\n                      onClick={async () => {\n                        await navigator.clipboard.writeText(props.data);\n                        toast.success('复制成功');\n                      }}\n                    >\n                      复制原始内容\n                    </DropdownMenuItem>\n                    <DropdownMenuItem\n                      className=\"cursor-pointer\"\n                      onClick={async () => {\n                        await navigator.clipboard.writeText(JSON.stringify(data.data));\n                        toast.success('复制成功');\n                      }}\n                    >\n                      复制为压缩JSON\n                    </DropdownMenuItem>\n                    <DropdownMenuItem\n                      className=\"cursor-pointer\"\n                      onClick={async () => {\n                        await navigator.clipboard.writeText(JSON5.stringify(data.data, null, 2));\n                        toast.success('复制成功');\n                      }}\n                    >\n                      复制为JSON5\n                    </DropdownMenuItem>\n                    <DropdownMenuItem\n                      className=\"cursor-pointer\"\n                      onClick={async () => {\n                        await navigator.clipboard.writeText(YAML.stringify(data.data, null, 2));\n                        toast.success('复制成功');\n                      }}\n                    >\n                      复制为YAML\n                    </DropdownMenuItem>\n                    <DropdownMenuItem\n                      className=\"cursor-pointer\"\n                      onClick={e => {\n                        setWithButtonGroup(false);\n                        props.onCloseButtonGroup?.(e.nativeEvent);\n                      }}\n                    >\n                      隐藏工具栏\n                    </DropdownMenuItem>\n                  </DropdownMenuGroup>\n                </DropdownMenuContent>\n              </DropdownMenu>\n            </ButtonGroup>\n          </div>\n        )}\n      </div>\n    </>\n  );\n}\n\nexport {\n  type DataType,\n  type DataViewerConfig,\n  type DataViewerProps,\n  DataViewer,\n  type InteractionResult,\n  type Interaction,\n  autoDetect,\n};\n",
      "type": "registry:component"
    }
  ],
  "css": {
    "@plugin tailwind-scrollbar": {}
  }
}